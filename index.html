<!DOCTYPE html>
<html lang='ru'>
<head>
<meta charset='utf-8' />
<style>
body {
	font-family: sans-serif;
}
table {
	border-collapse: collapse;
}
tbody {
	border-top: solid 1px gray;
}
td, th {
	text-align: left;
	padding: .2em;
	font-weight: normal;
}
td {
	white-space: nowrap;
}
tr.number-s td, tr.number-s th {
	padding-bottom: 0;
}
tr.number-p:not(:first-child) td, tr.number-p:not(:first-child) th {
	padding-top: 0;
}
th.group {
	min-width: 1em;
}
th.group span {
	writing-mode: vertical-rl;
	transform: rotate(180deg);
}
td[title], th[title] {
	text-decoration: underline dotted;
}
[class|=stem] {
	border-right: solid 1px green;
	padding: .22em .05em .22em 0;
}
[class|=end] {
	font-weight: bold;
	border-left: solid 1px green;
	padding: .22em 0 .22em .05em;
}
[class|=subend] {
	color: #333;
	font-weight: bold;
	border-left: solid 1px #DDD;
	padding: .22em 0 .22em .05em;
}
[class|=stem] + [class|=end] {
	border: none;
}
.stem-2, .end-2 {
	border-color: red;
}
.stem-1 strong, .end-1 strong {
	color: green;
	font-style: normal;
}
.stem-2 strong, .end-2 strong {
	color: red;
	font-style: normal;
}
.stem-1 strong:empty, .end-1 strong:empty, .stem-2 strong:empty, .end-2 strong:empty {
	display: inline-block;
	width: .5ex;
}
.stem-1 strong:empty, .end-1 strong:empty {
	border-bottom: solid 1px green;
}
.stem-2 strong:empty, .end-2 strong:empty {
	border-bottom: solid 1px red;
}
</style>
</head>
<body>
<script>
const verbFormGroups=[
	['',['inf','ger','par']],
	['Presente','pres'],
	['Pretérito','pret'],
	['<abbr title=Pretérito>Pr.</abbr> imperfecto','imp'],
	['Imperativo','im'],
]
const verbForms={
	inf: ['Infinitivo','инфинитив'],
	ger: ['Gerundio','для образования аналога continuous в английском по схеме спряжённый-estar + Ger. ("estoy estudiando" = "I am studying")'],
	par: ['Participio','страдательное(?) причастие прошедшего времени, меняется по родам и числам (apagado = выключенный, apagada = выключенная)'],
	im2s: ['tú','tú: ты сделай; форма глагола обычно совпадает с 3-м лицом ед. ч. Presente'],
	im3s: ['usted','usted: (вежливое) вы сделайте; форма глагола обычно совпадает императивом для tú, только окончание a меняется на e и наоборот'],
	im1p: ['nosotros','nosotros, nosotras: давайте мы сделаем'],
	im2p: ['vosotros','vosotros, vosotras: (множественное) вы сделайте'],
	im3p: ['ustedes','ustedes: (вежливое множественное) вы сделайте'],
}
for (const [prefix,[v1s,v2s,v3sm,v3sf,v1p,v2p,v3p]] of [
	['pres',['делаю','делаешь','делает','делает','делаем','делаете','делают']],
	['pret',['сделал(а)','сделал(а)','сделал','сделала','сделали','сделали','сделали']],
	['imp' ,['делал(а)','делал(а)','делал','делала','делали','делали','делали']],
]) {
	verbForms[prefix+'1s']=['yo',`yo: я ${v1s}`]
	verbForms[prefix+'2s']=['tú',`tú: ты ${v2s}`]
	verbForms[prefix+'3s']=['él',`él: он ${v3sm}; ella: она ${v3sf}; usted: (вежливое) вы ${v2p}`]
	verbForms[prefix+'1p']=['nosotros',`nosotros, nosotras: мы ${v1p}`]
	verbForms[prefix+'2p']=['vosotros',`vosotros, vosotras: (множественное) вы ${v2p}`]
	verbForms[prefix+'3p']=['ellos',`ellos, ellas: они ${v3p}; ustedes: (вежливое множественное) вы ${v2p}`]
}
const compactableVerbForms={
	pres3: ['él<em>los</em>',verbForms['pres3s'][1]+'; '+verbForms['pres3p'][1]],
	pret2: ['tú',verbForms['pret2s'][1]+'; '+verbForms['pret2p'][1]],
	imp3: ['él<em>los</em>',verbForms['imp3s'][1]+'; '+verbForms['imp3p'][1]],
	im3: ['usted<em>es</em>','usted, ustedes: (вежливое) вы сделайте'],
}
const v1=(...aa)=>{
	const a=[].concat.apply([],aa.map(s=>Array.isArray(s)?[s]:s.split(',')))
	return [
		'inf','ger','par',
		'pres1s','pres2s','pres3s','pres1p','pres2p','pres3p',
		'pret1s','pret2s','pret3s','pret1p','pret2p','pret3p',
		'imp1s','imp2s','imp3s','imp1p','imp2p','imp3p',
		'im2s','im3s','im1p','im2p','im3p'
	].reduce((o,k,i)=>({...o,[k]:a[i]}),{})
}
const v1forms=(inf,ar,er,ir)=>{
	const [stem,end]=inf.split(/(..)$/)
	const gen=a=>a.split(',').map(s=>`${stem}|${s}`).join(',')
	if (end=='ar') {
		return gen(ar)
	} else if (end=='er') {
		return gen(er)
	} else if (end=='ir') {
		return gen(ir)
	}
	throw 'unrecognized verb form'
}
const v1pres=(inf)=>v1forms(inf,
	'o,as,a,amos,áis,an',
	'o,es,e,emos,éis,en',
	'o,es,e,imos,ís,en',
)
const v1pret=(inf)=>v1forms(inf,
	'é,aste,ó,amos,asteis,aron',
	'í,iste,ió,imos,isteis,ieron',
	'í,iste,ió,imos,isteis,ieron',
)
const v1imp=(inf)=>v1forms(inf,
	'ab|a,ab|as,ab|a,áb|amos,ab|ais,ab|an',
	'í|a,í|as,í|a,í|amos,í|ais,í|an',
	'í|a,í|as,í|a,í|amos,í|ais,í|an',
)
const v1yendo=(inf)=>[`${inf.slice(0,-2)}|[y]endo`,'после гласной -iendo меняется на -yendo']
const v1jo=(inf)=>[`${inf.slice(0,-3)}[j]|o`,'у -ger и -gir-глаголов вместо -go пишется -jo']
const verbs=[
	['hablar',v1(
		'habl|ar,habl|ando,habl|ado',
		v1pres('hablar'),v1pret('hablar'),v1imp('hablar'),
		'habl|a,habl|e,habl|emos,habl|ad,habl|en',
	),'говорить'],
	['comer',v1(
		'com|er,com|iendo,com|ido',
		v1pres('comer'),v1pret('comer'),v1imp('comer'),
		'com|e,com|a,com|amos,com|ed,com|an',
	),'есть'],
	['vivir',v1(
		'viv|ir,viv|iendo,viv|ido',
		v1pres('vivir'),v1pret('vivir'),v1imp('vivir'),
		'viv|e,viv|a,viv|amos,viv|id,viv|an',
	),'жить'],
	['estar',v1(
		'est|ar,est|ando,est|ado',
		'est|o[y],est|[á]s,est|[á],est|amos,est|áis,est|[á]n',
		'estuv#[e],estuv#iste,estuv#[o],estuv#imos,estuv#isteis,estuv#ieron',
		v1imp('estar'),
		'est|[á],est|[é],est|emos,est|ad,est|[é]n',
	),['быть','быть временно, быть в указанном месте']],
	['ser',v1(
		's|er,s|iendo,s|ido',
		's|o[y],er#es,e[s]#,s|[o]mos,s|[o]is,s|[o]n',
		'fu#[i],fu#iste,fu#[e],fu#imos,fu#isteis,fu#eron',
		'er#[]#a,er#[]#as,er#[]#a,[é]r#[]#amos,er#[]#ais,er#[]#an',
		's|[é],s[e]|a,s[e]|amos,s|ed,s[e]|an',
	),['быть','быть постоянно, быть в указанный момент времени']],
	['ir',v1(
		'#ir,#[y]endo,#ido',
		'v|o[y],v|as,v|a,v|amos,v|[a]is,v|an',
		'fu#[i],fu#iste,fu#[e],fu#imos,fu#isteis,fu#eron',
		'ib#[]#a,ib#[]#as,ib#[]#a,[í]b#[]#amos,ib#[]#ais,ib#[]#an',
		'v|e,v[ay]|a,v[ay]|amos,#id,v[ay]|an',
	),'идти'],
	['dar',v1(
		'd|ar,d|ando,d|ado',
		'd|o[y],d|as,d|a,d|amos,d|[a]is,d|an',
		'd|[i],d|[i]ste,d|[io],d|[i]mos,d|[i]steis,d|[ie]ron',
		v1imp('dar'),
		'd|a,d|[é],d|emos,d|ad,d|en',
	),'давать'],
	['leer',v1(
		'le|er',v1yendo('leer'),'le|[í]do',
		v1pres('leer'),
		'le|í,le|[í]ste,le|[y]ó,le|[í]mos,le|[í]steis,le|[y]eron',
		v1imp('leer'),
		'le|e,le|a,le|amos,le|ed,le|an',
	),'читать'],
	['ver',v1(
		'v|er,v|iendo,v|i[st]o',
		'v[e]|o,v|es,v|e,v|emos,v|[e]is,v|en',
		'v|[i],v|iste,v|i[o],v|imos,v|isteis,v|ieron',
		v1imp('v[e]er'),
		'v|e,v[e]|a,v[e]|amos,v|ed,v[e]|an',
	),'видеть'],
	['venir',v1(
		'ven|ir,v[i]n|iendo,ven|ido',
		'ven[g]|o,v[i]en|es,v[i]en|e,ven|imos,ven|ís,v[i]en|en',
		'v[i]n|[e],v[i]n|iste,v[i]n|[o],v[i]n|imos,v[i]n|isteis,v[i]n|ieron',
		v1imp('venir'),
		'ven|[],ven[g]|a,ven[g]|amos,ven|id,ven[g]|an',
	),'приходить'],
	['hacer',v1(
		'hac|er,hac|iendo,h[e]|[ch]o',
		'ha[g]|o,hac|es,hac|e,hac|emos,hac|éis,hac|en',
		'h[i]c|[e],h[i]c|iste,h[iz]|[o],h[i]c|imos,h[i]c|isteis,h[i]c|ieron',
		v1imp('hacer'),
		'ha[z]|[],ha[g]|a,ha[g]|amos,hac|ed,ha[g]|an',
	),'делать'],
	['poner',v1(
		'pon|er,pon|iendo,pu[e]s#[t]o',
		'pon[g]|o,pon|es,pon|e,pon|emos,pon|éis,pon|en',
		'pus#[e],pus#iste,pus#[o],pus#imos,pus#isteis,pus#ieron',
		v1imp('poner'),
		'pon|[],pon[g]|a,pon[g]|amos,pon|ed,pon[g]|an',
	),'ставить'],
	['tener',v1(
		'ten|er,ten|iendo,ten|ido',
		'ten[g]|o,t[i]en|es,t[i]en|e,ten|emos,ten|éis,t[i]en|en',
		'tuv#[e],tuv#iste,tuv#[o],tuv#imos,tuv#isteis,tuv#ieron',
		v1imp('tener'),
		'ten|[],ten[g]|a,ten[g]|amos,ten|ed,ten[g]|an',
	),'иметь'],
	['saber',v1(
		'sab|er,sab|iendo,sab|ido',
		's#[é],sab|es,sab|e,sab|emos,sab|éis,sab|en',
		'sup#[e],sup#iste,sup#[o],sup#imos,sup#isteis,sup#ieron',
		v1imp('saber'),
		'sab|e,sep#a,sep#amos,sab|ed,sep#an',
	),['знать','знать факт/навык']],
	['conocer',v1(
		'conoc|er,conoc|iendo,conoc|ido',
		'cono[z]c|o,conoc|es,conoc|e,conoc|emos,conoc|éis,conoc|en',
		v1pret('conocer'),v1imp('conocer'),
		'conoc|e,cono[z]c|a,cono[z]c|amos,conoc|ed,cono[z]c|an',
	),['знать','знать человека/место']],
	['traer',v1(
		'tra|er',v1yendo('traer'),'tra|ído',
		'tra[ig]|o,tra|es,tra|e,tra|emos,tra|éis,tra|en',
		'traj#[e],traj#iste,traj#[o],traj#imos,traj#isteis,traj#[]eron',
		v1imp('traer'),
		'tra|e,tra[ig]|a,tra[ig]|amos,tra|ed,tra[ig]|an',
	),'приносить'],
	['coger',v1( // considered regular
		'cog|er,cog|iendo,cog|ido',
		v1jo('coger'),'cog|es,cog|e,cog|emos,cog|éis,cog|en',
		v1pret('coger'),v1imp('coger'),
		'cog|e,co[j]|a,co[j]|amos,cog|ed,co[j]|an',
	),'брать'],
	['elegir',v1(
		'eleg|ir,el[i]g|iendo,ele[c]|[t]o',
		v1jo('el[i]gir'),'el[i]g|es,el[i]g|e,eleg|imos,eleg|ís,el[i]g|en',
		'eleg|í,eleg|iste,el[i]g|ió,eleg|imos,eleg|isteis,el[i]g|ieron',
		v1imp('elegir'),
		'el[i]g|e,el[ij]|a,el[ij]|amos,eleg|id,el[ij]|an',
	),'выбирать'],
	['seguir',v1(
		'segu|ir',['s[i]gu|iendo','-yendo нет, хотя -iendo предшествует гласная'],'segu|ido',
		's[i]g[]|o,s[i]gu|es,s[i]gu|e,segu|imos,segu|ís,s[i]gu|en',
		'segu|í,segu|iste,s[i]gu|ió,segu|imos,segu|isteis,s[i]gu|ieron',
		v1imp('seguir'),
		's[i]gu|e,s[i]g[]|a,s[i]g[]|amos,segu|id,s[i]g[]|an',
	),'следовать'],
	['poder',v1(
		'pod|er,p[u]d|iendo,pod|ido',
		'p[ue]d|o,p[ue]d|es,p[ue]d|e,pod|emos,pod|éis,p[ue]d|en',
		'p[u]d|[e],p[u]d|iste,p[u]d|[o],p[u]d|imos,p[u]d|isteis,p[u]d|ieron',
		v1imp('poder'),
		'p[ue]d|e,p[ue]d|a,pod|amos,pod|ed,p[ue]d|an',
	),'мочь'],
	['empezar',v1(
		'empez|ar,empez|ando,empez|ado',
		'emp[i]ez|o,emp[i]ez|as,emp[i]ez|a,empez|amos,empez|áis,emp[i]ez|an',
		['empe[c]|é','у -zar-глаголов -zé меняется на -cé'],'empez|aste,empez|ó,empez|amos,empez|asteis,empez|aron',
		v1imp('empezar'),
		'emp[i]ez|a,emp[i]e[c]|e,empe[c]|emos,empez|ad,emp[i]e[c]|en',
	),'начинать'],
	['tocar',v1(
		'toc|ar,toc|ando,toc|ado',
		v1pres('tocar'),
		['to[qu]|é','у -car-глаголов -cé меняется на -qué'],'toc|aste,toc|ó,toc|amos,toc|asteis,toc|aron',
		v1imp('tocar'),
		'toc|a,to[qu]|e,to[qu]|emos,toc|ad,to[qu]|en',
	),'трогать'],
]

const createTable=($container,sortType)=>{
	while ($container.firstChild) $container.removeChild($container.firstChild)
	const $table=document.createElement('table')
	$table.setAttribute('lang','es')
	const $thead=document.createElement('thead')
	$table.appendChild($thead)
	$thead.insertRow().innerHTML="<th colspan=2><th><abbr title='Primera conjugación'>1ª conj.</abbr><th><abbr title='Segunda conjugación'>2ª conj.</abbr><th><abbr title='Tercera conjugación'>3ª conj.</abbr>"
	const readPair=(a)=>Array.isArray(a)?a:[a,'']
	for (const [formGroupName,formGroupMembersOrPrefix] of verbFormGroups) {
		const $tbody=document.createElement('tbody')
		$table.appendChild($tbody)
		let firstInGroup=true
		let formGroupMembers=formGroupMembersOrPrefix
		if (!Array.isArray(formGroupMembersOrPrefix)) {
			formGroupMembers=[]
			const prefix=formGroupMembersOrPrefix
			if (sortType!='number') {
				for (const p of [1,2,3]) {
					for (const n of ['s','p']) {
						if (verbForms[prefix+p+n]) formGroupMembers.push(prefix+p+n)
					}
				}
			} else {
				for (const n of ['s','p']) {
					for (const p of [1,2,3]) {
						if (verbForms[prefix+p+n]) formGroupMembers.push(prefix+p+n)
					}
				}
			}
		}
		for (formId of formGroupMembers) {
			const $row=$tbody.insertRow()
			const formPreNumber=formId.slice(0,-1)
			const formNumber=formId.slice(-1)
			let compactRow=false
			if (sortType=='person-compact' && formPreNumber in compactableVerbForms) {
				compactRow=true
				if (formId==formPreNumber+'p') continue
			}
			if (!compactRow && sortType!='number' && (formNumber=='s' || formNumber=='p')) {
				$row.classList.add('number-'+formNumber)
			}
			if (firstInGroup && formGroupName) {
				const $formGroupCell=document.createElement('th')
				$row.appendChild($formGroupCell)
				$formGroupCell.innerHTML='<span>'+formGroupName+'</span>'
				$formGroupCell.classList.add('group')
				$formGroupCell.setAttribute('rowspan',formGroupMembers.length)
			}
			firstInGroup=false
			let [formText,formNote]=verbForms[formId]
			if (compactRow) {
				[formText,formNote]=compactableVerbForms[formPreNumber]
			}
			const $formCell=document.createElement('th')
			if (!formGroupName) $formCell.setAttribute('colspan',2)
			$row.appendChild($formCell)
			$formCell.innerHTML=formText
			$formCell.setAttribute('title',formNote)
			const getFormHtml=(form)=>{
				let variant=1
				let [stem,end,subend]=form.split('|')
				if (end===undefined) {
					variant=2
					;[stem,end,subend]=form.split('#')
				}
				const mark=(s)=>s.replace(/\[(.*?)\]/g,'<strong>$1</strong>')
				const makeSpan=(cls,s)=>s?`<span class=${cls}-${variant}>${mark(s)}</span>`:''
				let t=makeSpan('stem',stem)+makeSpan('end',end)
				if (subend!==undefined) t+=makeSpan('subend',subend)
				return t
			}
			for (const [verb,forms] of verbs) {
				const [form,formNote]=readPair(forms[formId])
				const $cell=$row.insertCell()
				if (!forms[formId]) continue
				if (compactRow) {
					const [form2]=readPair(forms[formPreNumber+'p'])
					if (form2.startsWith(form)) {
						$cell.innerHTML=getFormHtml(`${form}<em>${form2.slice(form.length)}</em>`)
					} else {
						$cell.innerHTML=getFormHtml(form)+" / "+getFormHtml(form2)
					}
				} else {
					$cell.innerHTML=getFormHtml(form)
					if (formNote) $cell.setAttribute('title',formNote)
				}
			}
		}
	}
	{
		const $tbody=document.createElement('tbody')
		$table.appendChild($tbody)
		{
			const $row=$tbody.insertRow()
			$row.setAttribute('lang','ru')
			const $cell=document.createElement('th')
			$cell.setAttribute('colspan',2)
			$row.appendChild($cell)
			for (const [verb,forms,translationData] of verbs) {
				const [translation,translationNote]=readPair(translationData)
				const $cell=$row.insertCell()
				$cell.innerHTML=translation
				if (translationNote) $cell.setAttribute('title',translationNote)
			}
		}
		{
			const $row=$tbody.insertRow()
			const $cell=document.createElement('th')
			$cell.setAttribute('colspan',2)
			$row.appendChild($cell)
			for (const [verb] of verbs) {
				$row.insertCell().innerHTML="<a href=https://es.wiktionary.org/wiki/"+verb+"#Conjugaci%C3%B3n>[w]</a>"
			}
		}
	}
	$container.appendChild($table)
}

const $body=document.getElementsByTagName('body')[0]
const $tableContainer=document.createElement('div')
$body.appendChild($tableContainer)
createTable($tableContainer,'number')
const $optionsContainer=document.createElement('details')
$optionsContainer.innerHTML="<summary>Настройки</summary>"
const $groupingControls=document.createElement('div')
$groupingControls.innerHTML="<label><input type=radio name=sort value=number checked /> Обычный порядок</label><label><input type=radio name=sort value=person /> Сгруппировать по лицу</label>"
$groupingControls.innerHTML=[
	['number checked','Обычный порядок'],
	['person','Группировка по лицам'],
	['person-compact','...с уплотнением'],
].map(([id,text])=>`<label><input type=radio name=sort value=${id} /> ${text}</label>`).join('')
$groupingControls.addEventListener('change',(ev)=>{
	createTable($tableContainer,ev.target.value)
})
$optionsContainer.appendChild($groupingControls)
$body.appendChild($optionsContainer)
</script>
</body>
</html>
